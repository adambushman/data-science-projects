<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Adam Bushman">
<meta name="dcterms.date" content="2024-10-08">
<meta name="description" content="Leveraging penalized regression in R to predict housing prices in Sacramento, CA">

<title>Penalized Regression | Sacramento Housing Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="model.r_files/libs/clipboard/clipboard.min.js"></script>
<script src="model.r_files/libs/quarto-html/quarto.js"></script>
<script src="model.r_files/libs/quarto-html/popper.min.js"></script>
<script src="model.r_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="model.r_files/libs/quarto-html/anchor.min.js"></script>
<link href="model.r_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="model.r_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="model.r_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="model.r_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="model.r_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<style>html{ scroll-behavior: smooth; }</style>
<script src="model.r_files/libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>

<script src="model.r_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="model.r_files/libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">

<script src="model.r_files/libs/leaflet-1.3.1/leaflet.js"></script>

<link href="model.r_files/libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">

<script src="model.r_files/libs/proj4-2.6.2/proj4.min.js"></script>

<script src="model.r_files/libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>

<link href="model.r_files/libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">

<script src="model.r_files/libs/leaflet-binding-2.2.2/leaflet.js"></script>

<script src="model.r_files/libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>

<script src="model.r_files/libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#assignment-questions" id="toc-assignment-questions" class="nav-link active" data-scroll-target="#assignment-questions">Assignment Questions</a>
  <ul class="collapse">
  <li><a href="#name" id="toc-name" class="nav-link" data-scroll-target="#name">Name</a></li>
  <li><a href="#perspective" id="toc-perspective" class="nav-link" data-scroll-target="#perspective">Perspective</a></li>
  <li><a href="#question" id="toc-question" class="nav-link" data-scroll-target="#question">Question</a></li>
  <li><a href="#data-set" id="toc-data-set" class="nav-link" data-scroll-target="#data-set">Data set</a></li>
  <li><a href="#predictors-and-targets" id="toc-predictors-and-targets" class="nav-link" data-scroll-target="#predictors-and-targets">Predictor(s) and target(s)</a></li>
  <li><a href="#model-resonability" id="toc-model-resonability" class="nav-link" data-scroll-target="#model-resonability">Model resonability</a></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  <li><a href="#assumptions" id="toc-assumptions" class="nav-link" data-scroll-target="#assumptions">Assumptions</a></li>
  </ul></li>
  <li><a href="#assignment-workflow" id="toc-assignment-workflow" class="nav-link" data-scroll-target="#assignment-workflow">Assignment Workflow</a>
  <ul class="collapse">
  <li><a href="#analysis-prep" id="toc-analysis-prep" class="nav-link" data-scroll-target="#analysis-prep">Analysis Prep</a>
  <ul class="collapse">
  <li><a href="#loading-packages" id="toc-loading-packages" class="nav-link" data-scroll-target="#loading-packages">Loading packages</a></li>
  <li><a href="#loading-the-data" id="toc-loading-the-data" class="nav-link" data-scroll-target="#loading-the-data">Loading the data</a></li>
  <li><a href="#data-set-inspection" id="toc-data-set-inspection" class="nav-link" data-scroll-target="#data-set-inspection">Data set inspection</a></li>
  </ul></li>
  <li><a href="#simple-exploratory-data-analysis" id="toc-simple-exploratory-data-analysis" class="nav-link" data-scroll-target="#simple-exploratory-data-analysis">Simple Exploratory Data Analysis</a>
  <ul class="collapse">
  <li><a href="#multicollinearity" id="toc-multicollinearity" class="nav-link" data-scroll-target="#multicollinearity">Multicollinearity</a></li>
  <li><a href="#linear-relationship-normally-distributed-residuals" id="toc-linear-relationship-normally-distributed-residuals" class="nav-link" data-scroll-target="#linear-relationship-normally-distributed-residuals">Linear relationship &amp; Normally distributed residuals</a></li>
  <li><a href="#homoscedasticity-of-residuals" id="toc-homoscedasticity-of-residuals" class="nav-link" data-scroll-target="#homoscedasticity-of-residuals">Homoscedasticity of residuals</a></li>
  </ul></li>
  <li><a href="#preprocessing" id="toc-preprocessing" class="nav-link" data-scroll-target="#preprocessing">Preprocessing</a>
  <ul class="collapse">
  <li><a href="#data-cleaning-feature-engineering" id="toc-data-cleaning-feature-engineering" class="nav-link" data-scroll-target="#data-cleaning-feature-engineering">Data cleaning / Feature Engineering</a></li>
  </ul></li>
  <li><a href="#model-resources" id="toc-model-resources" class="nav-link" data-scroll-target="#model-resources">Model resources</a>
  <ul class="collapse">
  <li><a href="#splitting-for-trainingtesting-sets" id="toc-splitting-for-trainingtesting-sets" class="nav-link" data-scroll-target="#splitting-for-trainingtesting-sets">Splitting for training/testing sets</a></li>
  </ul></li>
  <li><a href="#training-and-tuning" id="toc-training-and-tuning" class="nav-link" data-scroll-target="#training-and-tuning">Training and tuning</a>
  <ul class="collapse">
  <li><a href="#fit-a-model" id="toc-fit-a-model" class="nav-link" data-scroll-target="#fit-a-model">Fit a model</a></li>
  <li><a href="#evaluating-tuning" id="toc-evaluating-tuning" class="nav-link" data-scroll-target="#evaluating-tuning">Evaluating tuning</a></li>
  </ul></li>
  <li><a href="#final-model" id="toc-final-model" class="nav-link" data-scroll-target="#final-model">Final model</a>
  <ul class="collapse">
  <li><a href="#predict-on-testing" id="toc-predict-on-testing" class="nav-link" data-scroll-target="#predict-on-testing">Predict on testing</a></li>
  <li><a href="#evaluating-metrics" id="toc-evaluating-metrics" class="nav-link" data-scroll-target="#evaluating-metrics">Evaluating metrics</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#high-value-properties-1" id="toc-high-value-properties-1" class="nav-link" data-scroll-target="#high-value-properties-1">High value properties</a></li>
  <li><a href="#plotting-high-value-properties" id="toc-plotting-high-value-properties" class="nav-link" data-scroll-target="#plotting-high-value-properties">Plotting high value properties</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Penalized Regression | Sacramento Housing Data</h1>
</div>

<div>
  <div class="description">
    Leveraging penalized regression in R to predict housing prices in Sacramento, CA
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Adam Bushman </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 8, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="assignment-questions" class="level1">
<h1>Assignment Questions</h1>
<section id="name" class="level2">
<h2 class="anchored" data-anchor-id="name">Name</h2>
<blockquote class="blockquote">
<p>What is your name? Include all team members if submitting as a group.</p>
</blockquote>
<p>Adam Bushman [u6049169]; no group members.</p>
</section>
<section id="perspective" class="level2">
<h2 class="anchored" data-anchor-id="perspective">Perspective</h2>
<blockquote class="blockquote">
<p>From what perspective ar you conducting the analysis? (Who are you? / Who are you working for?)</p>
</blockquote>
<p>I am a real estate broker, working with clients eager to invest in residential real estate. These clients want their capital to stretch as far as possible; said differently, they’re looking for good deals (highest value per dollar spent) on each property. My job as the broker is to identify high value properties and guide them to submitting competitive yet high ROI offers.</p>
</section>
<section id="question" class="level2">
<h2 class="anchored" data-anchor-id="question">Question</h2>
<blockquote class="blockquote">
<p>What is your question?</p>
</blockquote>
<p>My newest client is looking for properties in the Sacramento, CA market. I’m far less familiar with Sacramento, as I normally operate in the Bay Area (San Francisco, Oakland, etc). Therefore, I must rely on a more data-driven approach to finding high value properties.</p>
<p><em>Can I develop a solid predictive model for housing prices in the Sacramento area, where a delta in the predicted price and listed sales price may indicate potential value?</em></p>
</section>
<section id="data-set" class="level2">
<h2 class="anchored" data-anchor-id="data-set">Data set</h2>
<blockquote class="blockquote">
<p>Describe your dataset(s) including URL (if available)</p>
</blockquote>
<p>Data sourced from Posit via their <a href="https://modeldata.tidymodels.org/reference/Sacramento.html">{modeldata}</a> package, accessed October 4th, 2024. The data was originally sourced from <a href="https://support.spatialkey.com/spatialkey-sample-csv-data/">Insurity Spacial Key</a>. Their original description of the datais as follows:</p>
<blockquote class="blockquote">
<p>The Sacramento real estate transactions file is a list of 985 real estate transactions in the Sacramento area reported over a five-day period, as reported by the Sacramento Bee.</p>
</blockquote>
<p>The data set includes attributes relative to location of the property and common specification measures.</p>
</section>
<section id="predictors-and-targets" class="level2">
<h2 class="anchored" data-anchor-id="predictors-and-targets">Predictor(s) and target(s)</h2>
<blockquote class="blockquote">
<p>What is (are) your independent variable(s) and dependent variable(s)? Include variable type (binary, categorical, numeric).</p>
</blockquote>
<p>The dependent variable (target) natural to this situation is <code>price</code>. Because the client wants to find properties whose worth exceeds that of the sales price, this is the right choice. The independent variables (predictors) are <code>city</code>, <code>zip</code>, <code>beds</code>, <code>baths</code>, <code>sqft</code>, <code>type</code>, <code>latitude</code>, and <code>longitude</code>.</p>
<p>For a complete description of each feature and their data types, navigate to the <a href="#data-dictionary">data dictionary</a>.</p>
</section>
<section id="model-resonability" class="level2">
<h2 class="anchored" data-anchor-id="model-resonability">Model resonability</h2>
<blockquote class="blockquote">
<p>How are your variables suitable for your analysis method?</p>
</blockquote>
<p>The variables chosen above are the extent of the dataset (all features used). The analysis method chosen is a penalized regression elastic net model.</p>
<p>These variables and the analysis method are a natural pairing thanks to:</p>
<ul>
<li>Meeting the required <a href="#linear-relationship-normally-distributed-residuals">assumptions</a>
<ul>
<li>Linear relationship between predictors and target</li>
<li>Normally distributed residuals</li>
<li>Homoscedasticity of residuals (balanced values)</li>
</ul></li>
<li>Presence of <a href="#multicollinearity">multicollinearity</a>
<ul>
<li>Penalized regression resolves multicollinearity thanks to the applied penalty</li>
</ul></li>
<li>Feature reduction
<ul>
<li>While this dataset only has 8 predictors, the unique values of factor data types will expand the scope
<ul>
<li><code>city</code> has 37 unique values</li>
<li><code>zip</code> has 68 unique values</li>
<li><code>type</code> has 3 unique values</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<blockquote class="blockquote">
<p>What are your conclusions (include references to one or two CLEARLY INDICATED AND IMPORTANT graphs or tables in your output)?</p>
</blockquote>
<section id="model-effectiveness" class="level4">
<h4 class="anchored" data-anchor-id="model-effectiveness">Model effectiveness</h4>
<p>A penalized regression model achieved the objective of a) leveraging a data set ill-suited for a traditual Ordinary Least Squares (OLS) regression model and b) achiving a smaller model with nearly the same performance.</p>
<p>Throughout the training workflow, the measurement for Mean Squared Error was found to be <strong>~0.11</strong> while the testing workflow resulted in an MSE of <strong>~0.12</strong>.</p>
</section>
<section id="high-value-properties" class="level4">
<h4 class="anchored" data-anchor-id="high-value-properties">High value properties</h4>
<p>As a broker, the resulting predicitons of <code>price</code> compared to the original “sales” <code>price</code> were a tremendous aid in pinpointing high value properties for the client. Given my lack of familiarity with the Sacramento, CA market, this proved an invaluable first step in a) learning the market and b) accelerating the process.</p>
<p>Navigate to a list of the <a href="#property-list">top-10 high value properties</a> uncovered by the model.</p>
</section>
<section id="touring-the-properties" class="level4">
<h4 class="anchored" data-anchor-id="touring-the-properties">Touring the properties</h4>
<p>As a broker, the next step would be to get the client to the properties. We’re already saving time and money by prioritizing properties that best align to the interest of the client. To best prepare for the tours, I would want to get a better sense for absolute and relative location.</p>
<p>Navigate to a <a href="#property-map">map of high value properties</a>, an ideal tool for expediting the process.</p>
</section>
</section>
<section id="assumptions" class="level2">
<h2 class="anchored" data-anchor-id="assumptions">Assumptions</h2>
<blockquote class="blockquote">
<p>What are your assumptions and limitations? Did you include any robustness checks?</p>
</blockquote>
<p>Assumptions made throughout the analysis</p>
<ul>
<li>Understood that this is a sample of housing prices</li>
<li>Assumed that these are prices of “historically sold” properties in the area</li>
<li>Assumed that the client and broker (myself) define “high-value” as a delta between predicted price and sales price</li>
<li>Understood that “value” may exist in other areas, not just price (i.e.&nbsp;time to closing, offer terms, etc.)</li>
</ul>
</section>
</section>
<section id="assignment-workflow" class="level1">
<h1>Assignment Workflow</h1>
<section id="analysis-prep" class="level2">
<h2 class="anchored" data-anchor-id="analysis-prep">Analysis Prep</h2>
<section id="loading-packages" class="level3">
<h3 class="anchored" data-anchor-id="loading-packages">Loading packages</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'tidyverse'</span>)        <span class="co"># Wrapper for many convenient libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'modeldata'</span>)        <span class="co"># Contains data for the assignment</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'skimr'</span>)            <span class="co"># Quickly summarise data</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'gt'</span>)               <span class="co"># Render "great tables"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'leaflet'</span>)          <span class="co"># Make interactive maps</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'glmnet'</span>)           <span class="co"># Loading penalized regression library</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'rsample'</span>)          <span class="co"># Easy sampling and splitting</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'corrplot'</span>)         <span class="co"># Quick correlation plots</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loading-the-data" class="level3">
<h3 class="anchored" data-anchor-id="loading-the-data">Loading the data</h3>
<p>We’ll start off by referencing the “Sacramento Housing Data” for the assignment from the <code>{modeldata}</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>sac_raw <span class="ot">&lt;-</span> modeldata<span class="sc">::</span>Sacramento        <span class="co"># Data for the assignment</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With it loaded into the session, let’s get a sense for what we’re working with.</p>
</section>
<section id="data-set-inspection" class="level3">
<h3 class="anchored" data-anchor-id="data-set-inspection">Data set inspection</h3>
<p>Right away, I like to get acquainted with the data set. That means understanding what each column seeks to describe, confirming the granularity of the rows, and getting my arms around structure, completeness, distribution, etc.</p>
<p>Posit, the company behind <code>{modeldata}</code>, did not include a data dictionary; however, the variables are sufficiently self-explanatory. Below is a derived data dictionary:</p>
<div id="data-dictionary">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(sac_data_dict) <span class="sc">%&gt;%</span>                                   <span class="co"># Create a "great tables" (gt) object</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(                                         <span class="co"># Rename some columns</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">variable =</span> <span class="st">"Variable Name"</span>, </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">datatype =</span> <span class="st">"Data Type"</span>, </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">description =</span> <span class="st">"Variable Description"</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_options</span>(</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">column_labels.background.color =</span> <span class="st">"#d9230f"</span>,     <span class="co"># Apply red header background</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">column_labels.font.weight =</span> <span class="st">"bold"</span>,             <span class="co"># Bold headers</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">row.striping.background =</span> <span class="st">'#FFFFFF'</span>             <span class="co"># Remove row striping</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="hdfqqozhqf" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#hdfqqozhqf table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hdfqqozhqf thead, #hdfqqozhqf tbody, #hdfqqozhqf tfoot, #hdfqqozhqf tr, #hdfqqozhqf td, #hdfqqozhqf th {
  border-style: none;
}

#hdfqqozhqf p {
  margin: 0;
  padding: 0;
}

#hdfqqozhqf .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hdfqqozhqf .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hdfqqozhqf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hdfqqozhqf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hdfqqozhqf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hdfqqozhqf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hdfqqozhqf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hdfqqozhqf .gt_col_heading {
  color: #FFFFFF;
  background-color: #D9230F;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hdfqqozhqf .gt_column_spanner_outer {
  color: #FFFFFF;
  background-color: #D9230F;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hdfqqozhqf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hdfqqozhqf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hdfqqozhqf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hdfqqozhqf .gt_spanner_row {
  border-bottom-style: hidden;
}

#hdfqqozhqf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hdfqqozhqf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hdfqqozhqf .gt_from_md > :first-child {
  margin-top: 0;
}

#hdfqqozhqf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hdfqqozhqf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hdfqqozhqf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hdfqqozhqf .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hdfqqozhqf .gt_row_group_first td {
  border-top-width: 2px;
}

#hdfqqozhqf .gt_row_group_first th {
  border-top-width: 2px;
}

#hdfqqozhqf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hdfqqozhqf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hdfqqozhqf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hdfqqozhqf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hdfqqozhqf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hdfqqozhqf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hdfqqozhqf .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hdfqqozhqf .gt_striped {
  background-color: #FFFFFF;
}

#hdfqqozhqf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hdfqqozhqf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hdfqqozhqf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hdfqqozhqf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hdfqqozhqf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hdfqqozhqf .gt_left {
  text-align: left;
}

#hdfqqozhqf .gt_center {
  text-align: center;
}

#hdfqqozhqf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hdfqqozhqf .gt_font_normal {
  font-weight: normal;
}

#hdfqqozhqf .gt_font_bold {
  font-weight: bold;
}

#hdfqqozhqf .gt_font_italic {
  font-style: italic;
}

#hdfqqozhqf .gt_super {
  font-size: 65%;
}

#hdfqqozhqf .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hdfqqozhqf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hdfqqozhqf .gt_indent_1 {
  text-indent: 5px;
}

#hdfqqozhqf .gt_indent_2 {
  text-indent: 10px;
}

#hdfqqozhqf .gt_indent_3 {
  text-indent: 15px;
}

#hdfqqozhqf .gt_indent_4 {
  text-indent: 20px;
}

#hdfqqozhqf .gt_indent_5 {
  text-indent: 25px;
}

#hdfqqozhqf .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#hdfqqozhqf div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Variable Name">Variable Name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Data Type">Data Type</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Variable Description">Variable Description</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="variable" class="gt_row gt_left">City</td>
<td headers="datatype" class="gt_row gt_left">&lt;factor&gt;</td>
<td headers="description" class="gt_row gt_left">City/community/suburb of Sacramento, CA</td></tr>
    <tr><td headers="variable" class="gt_row gt_left">Zip</td>
<td headers="datatype" class="gt_row gt_left">&lt;factor&gt;</td>
<td headers="description" class="gt_row gt_left">Zip code of Sacramento, CA</td></tr>
    <tr><td headers="variable" class="gt_row gt_left">Beds</td>
<td headers="datatype" class="gt_row gt_left">&lt;integer&gt;</td>
<td headers="description" class="gt_row gt_left">Number of bedrooms</td></tr>
    <tr><td headers="variable" class="gt_row gt_left">Baths</td>
<td headers="datatype" class="gt_row gt_left">&lt;double&gt;</td>
<td headers="description" class="gt_row gt_left">Number of bathrooms</td></tr>
    <tr><td headers="variable" class="gt_row gt_left">SqFt</td>
<td headers="datatype" class="gt_row gt_left">&lt;integer&gt;</td>
<td headers="description" class="gt_row gt_left">Square footage of the property</td></tr>
    <tr><td headers="variable" class="gt_row gt_left">Type</td>
<td headers="datatype" class="gt_row gt_left">&lt;factor&gt;</td>
<td headers="description" class="gt_row gt_left">Type of property</td></tr>
    <tr><td headers="variable" class="gt_row gt_left">Price</td>
<td headers="datatype" class="gt_row gt_left">&lt;factor&gt;</td>
<td headers="description" class="gt_row gt_left">Sale price of the property</td></tr>
    <tr><td headers="variable" class="gt_row gt_left">Latitude</td>
<td headers="datatype" class="gt_row gt_left">&lt;double&gt;</td>
<td headers="description" class="gt_row gt_left">Latitude coordinate value</td></tr>
    <tr><td headers="variable" class="gt_row gt_left">Longitude</td>
<td headers="datatype" class="gt_row gt_left">&lt;double&gt;</td>
<td headers="description" class="gt_row gt_left">Longitude coordinate value</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</div>
<p>Using the <code>{skimr}</code> package, we can get a comprehensive summary of the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(sac_raw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">sac_raw</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">932</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">ordered</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">city</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">37</td>
<td style="text-align: left;">SAC: 438, ELK: 114, ROS: 48, CIT: 35</td>
</tr>
<tr class="even">
<td style="text-align: left;">zip</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">68</td>
<td style="text-align: left;">z95: 61, z95: 45, z95: 44, z95: 37</td>
</tr>
<tr class="odd">
<td style="text-align: left;">type</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">Res: 866, Con: 53, Mul: 13</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">beds</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.28</td>
<td style="text-align: right;">0.89</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">4.00</td>
<td style="text-align: right;">8.00</td>
<td style="text-align: left;">▃▇▆▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">baths</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.05</td>
<td style="text-align: right;">0.72</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">5.00</td>
<td style="text-align: left;">▂▇▂▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sqft</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1680.32</td>
<td style="text-align: right;">726.27</td>
<td style="text-align: right;">484.00</td>
<td style="text-align: right;">1166.75</td>
<td style="text-align: right;">1470.00</td>
<td style="text-align: right;">1953.50</td>
<td style="text-align: right;">4878.00</td>
<td style="text-align: left;">▇▇▂▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">price</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">246661.58</td>
<td style="text-align: right;">131126.86</td>
<td style="text-align: right;">30000.00</td>
<td style="text-align: right;">156000.00</td>
<td style="text-align: right;">220000.00</td>
<td style="text-align: right;">305000.00</td>
<td style="text-align: right;">884790.00</td>
<td style="text-align: left;">▇▇▂▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">latitude</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">38.59</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">38.24</td>
<td style="text-align: right;">38.48</td>
<td style="text-align: right;">38.62</td>
<td style="text-align: right;">38.69</td>
<td style="text-align: right;">39.02</td>
<td style="text-align: left;">▁▆▇▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">longitude</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-121.36</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">-121.55</td>
<td style="text-align: right;">-121.45</td>
<td style="text-align: right;">-121.38</td>
<td style="text-align: right;">-121.31</td>
<td style="text-align: right;">-120.60</td>
<td style="text-align: left;">▇▅▁▁▁</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p>Initial observations include:</p>
<ul>
<li>With nearly 1K rows, we have a good sample size to work with</li>
<li>We have no missing values; this means we won’t have to eliminate records, features, or determine the best way to impute values</li>
<li>We so have some skewed distributions, most long, right tails; we’d likely benefit from some logarithmic transformations</li>
<li>The categorical/factor variables <code>city</code> and <code>zip</code> naturally have many distinct values. This could very well be where penalized regression shines in feature reduction</li>
<li>Latitude and longitude aren’t variables we’d expect a 1 unit increase/decrease to have some underlying, consistent relationship with price</li>
</ul>
</section>
</section>
<section id="simple-exploratory-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="simple-exploratory-data-analysis">Simple Exploratory Data Analysis</h2>
<section id="multicollinearity" class="level3">
<h3 class="anchored" data-anchor-id="multicollinearity">Multicollinearity</h3>
<p>One of the primary problems solved by penalized regression is multicollinearity (predictors that are highly correlated to each other). Let’s generate a correlation matrix for the numeric predictors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>sac_corr <span class="ot">&lt;-</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    sac_raw <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span>               <span class="co"># Select numeric variables</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cor</span>()                                       <span class="co"># Run pearson correlation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot.mixed</span>(sac_corr, <span class="at">order =</span> <span class="st">'AOE'</span>)         <span class="co"># Correlation plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="model.r_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Understandably, the non-latitude/longitude variables are highly correlated. The more square feet of a home, naturally the price will go up since its cost is directly associated with the size. Similar intuition applies to baths and beds.</p>
<p>Fortunately, penalized regression will handle this without a problem.</p>
<p>It’s important to check other assumptions, namely:</p>
<ul>
<li>Linear relationship between each predictor and outcome</li>
<li>Normally distributed residuals</li>
<li>Homoscedasticity of residuals</li>
</ul>
<p>We can check all three of these by running a basic linear model and generating plots therefrom:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>test_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> ., <span class="at">data =</span> sac_raw)       <span class="co"># Test linear model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="linear-relationship-normally-distributed-residuals" class="level3">
<h3 class="anchored" data-anchor-id="linear-relationship-normally-distributed-residuals">Linear relationship &amp; Normally distributed residuals</h3>
<p>Because we’re using a parametric, linear test with penalized regression, we need some semblance of a linear relationship. The below plots give enough indication there are linear relationships worth capturing in a model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sac_raw)       <span class="co"># Scatter plots</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="model.r_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Additionally, we need the residuals to approximate the normal distribution. The below plot indicates that we are sufficiently achieving both. There is more deviation from the line on the right tail, which we’ve already pointed out can be mitigated with a logarithmic transform where appropriate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(test_mod, <span class="at">which =</span> <span class="dv">2</span>)           <span class="co"># Normally distributed residuals visualization</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="model.r_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="homoscedasticity-of-residuals" class="level3">
<h3 class="anchored" data-anchor-id="homoscedasticity-of-residuals">Homoscedasticity of residuals</h3>
<p>We need the residuals to be fairly consistent in their distribution across fitted values. We don’t want to be seeing a cone shape, where the distribution is high on one end and narrow on the other. The below plot shows pretty consistent distribution of points along the y axis for all the values on the x axis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(test_mod, <span class="at">which =</span> <span class="dv">3</span>)           <span class="co"># Homoscedasticity of residuals visualization</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="model.r_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="preprocessing" class="level2">
<h2 class="anchored" data-anchor-id="preprocessing">Preprocessing</h2>
<section id="data-cleaning-feature-engineering" class="level3">
<h3 class="anchored" data-anchor-id="data-cleaning-feature-engineering">Data cleaning / Feature Engineering</h3>
<p>The data set is already complete and nicely formatted. Little, if anything, is needed on this front. We’ve mentioned previously that two variables, in particular looked to have right-skewed distributions: <code>price</code> and <code>sqft</code>. Let’s take a peek at these for confirmation.</p>
<p>First, we’ve alter the data for a long format (will make it easier to plot).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>sac_alt <span class="ot">&lt;-</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    sac_raw <span class="sc">%&gt;%</span>                     <span class="co"># Use the raw data</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(price, sqft) <span class="sc">%&gt;%</span>         <span class="co"># Select only price, sqft</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(                   <span class="co"># Pivot to long format</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">cols =</span> <span class="fu">everything</span>(), </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">"feature"</span>, </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we’ll create a function for plotting a <a href="https://www.cedricscherer.com/2021/06/06/visualizing-distributions-with-raincloud-plots-and-how-to-create-them-with-ggplot2/">“raincloud” visualization</a>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>plot_raincloud <span class="ot">&lt;-</span> <span class="cf">function</span>(data, val) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">"1"</span>, <span class="at">y =</span> {{ val }})) <span class="sc">+</span>                                 <span class="co"># Setup ggplot object</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    ggdist<span class="sc">::</span><span class="fu">stat_halfeye</span>(                                                       <span class="co"># Distribution plot</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">adjust =</span> <span class="fl">0.5</span>, </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="fl">0.6</span>, </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">.width =</span> <span class="dv">0</span>, </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">justification =</span> <span class="sc">-</span><span class="fl">0.2</span>, </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">point_color =</span> <span class="cn">NA</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(                                                               <span class="co"># Boxplot</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="fl">0.15</span>, </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">outlier.shape =</span> <span class="cn">NA</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    gghalves<span class="sc">::</span><span class="fu">geom_half_point</span>(                                                  <span class="co"># Individual observations</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">side =</span> <span class="st">"l"</span>, </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">range_scale =</span> <span class="fl">0.4</span>, </span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">alpha =</span> <span class="fl">0.2</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>feature, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span>                           <span class="co"># Two visualizations, side-by-side</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span>                                                           <span class="co"># Theme styling</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#BE0000"</span>, <span class="at">color =</span> <span class="cn">NA</span>), </span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_raincloud</span>(sac_alt, value)          <span class="co"># Generate a raincloud plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="model.r_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We do see the long, skewed tails. While not egregious, ideally we’d see a more normal distribution Would a logarithmic transform help?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>sac_alt <span class="ot">&lt;-</span> sac_alt <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">value_log =</span> <span class="fu">log</span>(value))           <span class="co"># Add a logarithmic transform</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_raincloud</span>(sac_alt, value_log)                              <span class="co"># Genearte another raincloud plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="model.r_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>That’s <strong>much</strong> better! Let’s end by creating a clean version of our data, featuring the logarithmic transforms:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>sac_clean <span class="ot">&lt;-</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    sac_raw <span class="sc">%&gt;%</span>                                                 <span class="co"># Use the original data</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(                                                     <span class="co"># Create natural log versions of the variables</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">sqft_log =</span> <span class="fu">log</span>(sqft), </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">price_log =</span> <span class="fu">log</span>(price)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(sqft, price))                                     <span class="co"># Remove non-log versions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using these logged versions will make it more difficult to interpret the model. However, the scenario prompting this analytical objective is mostly around finding potential value among investment properties. Therefore, our goal is less about interpreting the effects of predictors on price and instead on the gap in predicted and actual price (a signal of potential value).</p>
<p>We need only remember to convert the logged predictions back to their normal scale for use in communicating to the client.</p>
</section>
</section>
<section id="model-resources" class="level2">
<h2 class="anchored" data-anchor-id="model-resources">Model resources</h2>
<section id="splitting-for-trainingtesting-sets" class="level3">
<h3 class="anchored" data-anchor-id="splitting-for-trainingtesting-sets">Splitting for training/testing sets</h3>
<p>As is customary, we must split our data into training and testing sets. We’ll put aside the testing set and work with training until we’re comfortable with our model definition. The <code>{rsample}</code> package has a lot of helpful functions for this workflow. In just a couple lines we get training and testing sets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">819</span>)                                                   <span class="co"># Set reproducible seed</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>split_obj <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(sac_clean, <span class="at">prop =</span> <span class="fl">0.75</span>)              <span class="co"># Split object</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>sac_train <span class="ot">&lt;-</span> <span class="fu">training</span>(split_obj)                                <span class="co"># Split for training</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>sac_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(split_obj)                                  <span class="co"># Split for testing</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="training-and-tuning" class="level2">
<h2 class="anchored" data-anchor-id="training-and-tuning">Training and tuning</h2>
<section id="fit-a-model" class="level3">
<h3 class="anchored" data-anchor-id="fit-a-model">Fit a model</h3>
<p>What we want to do is use <code>cv.glmnet</code> and specify the cross-validation therein.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>nFolds <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>foldid <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">rep</span>(<span class="fu">seq</span>(nFolds), <span class="at">length.out =</span> <span class="fu">nrow</span>(sac_train)))        <span class="co"># Randomize folds</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>model_fit <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(                                                 <span class="co"># Run elastic net</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> sac_train <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>price_log) <span class="sc">%&gt;%</span> <span class="fu">data.matrix</span>(),             <span class="co"># Predictors</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> sac_train<span class="sc">$</span>price_log,                                            <span class="co"># Target</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"gaussian"</span>,                                                <span class="co"># Regression specification</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">type.measure =</span> <span class="st">"mse"</span>,                                               <span class="co"># Measure of interest</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">nfolds =</span> nFolds,                                                    <span class="co"># Number of cross-validation folds</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">foldid =</span> foldid                                                     <span class="co"># Reproducible folds</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Output results shared below may differ slightly from the descriptions thereafter due to the nature of <code>cv.glmnet</code>.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>model_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  cv.glmnet(x = sac_train %&gt;% select(-price_log) %&gt;% data.matrix(),      y = sac_train$price_log, type.measure = "mse", nfolds = nFolds,      foldid = foldid, family = "gaussian") 

Measure: Mean-Squared Error 

     Lambda Index Measure       SE Nonzero
min 0.00078    68  0.1016 0.008399       8
1se 0.05164    23  0.1099 0.007299       3</code></pre>
</div>
</div>
<p>The fitted model description gives us some good info:</p>
<ul>
<li>We see two values of <span class="math inline">\(\lambda\)</span>, one corresponding to the minimum (<code>min</code>) mean squared error and the other one (<code>1se</code>) corresponding to within one standard error of the minimum</li>
<li>The index shows low far along the process each value was achieved</li>
<li>Measure is our means squared error (MSE)</li>
<li>SE is the standard error</li>
<li>Nonzero tells us how many features/predictors remained in the model given the chosen lambda</li>
</ul>
<p>It’s interesting to note that a near traditional OLS model gave the lowest MSE but a simpler model (thanks to a higher lambda) is nearly as good at a <strong>~0.11</strong> MSE.</p>
</section>
<section id="evaluating-tuning" class="level3">
<h3 class="anchored" data-anchor-id="evaluating-tuning">Evaluating tuning</h3>
<p>Let’s see if we can’t plot these results:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="model.r_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><code>min</code> is indicated by the far left vertical line while <code>1se</code> is indicated by the far right vertical line.</p>
<p>We’re also able to look at the coefficients:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(model_fit, <span class="at">s =</span> <span class="st">"lambda.1se"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>9 x 1 sparse Matrix of class "dgCMatrix"
                       s1
(Intercept) 35.7815602609
city         .           
zip         -0.0005237118
beds         .           
baths        .           
type         .           
latitude     .           
longitude    0.2458808877
sqft_log     0.8659262743</code></pre>
</div>
</div>
<p>At first blush, <code>sqft_log</code> and <code>zip</code> make a lot of sense given size and location are some of the most natural drivers of price. The absense of <code>type</code> and inclusion of <code>longitude</code> is curious.</p>
</section>
</section>
<section id="final-model" class="level2">
<h2 class="anchored" data-anchor-id="final-model">Final model</h2>
<section id="predict-on-testing" class="level3">
<h3 class="anchored" data-anchor-id="predict-on-testing">Predict on testing</h3>
<p>The next step is to train the previous model (<code>1se</code>) with the entire training data and then use it to predict training data values. Why <code>1se</code> and not <code>min</code>? We achieve a far simpler model with little impact to MSE.</p>
<p>Let’s setup the prediction:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>sac_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(                            <span class="co"># Make predictions</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    model_fit,                                  <span class="co"># Original fit from above</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">newx =</span> sac_test <span class="sc">%&gt;%</span>                         <span class="co"># Using the testing data we haven't worked with yet</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="sc">-</span>price_log) <span class="sc">%&gt;%</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">data.matrix</span>(),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">s =</span> <span class="st">"lambda.1se"</span>                            <span class="co"># Use the penalty within 1 standard error</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sac_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     lambda.1se
[1,]   11.68184
[2,]   11.97621
[3,]   12.00757
[4,]   11.76178
[5,]   11.99953
[6,]   12.14830</code></pre>
</div>
</div>
<p>We now want to calculate the mean squared error.</p>
</section>
<section id="evaluating-metrics" class="level3">
<h3 class="anchored" data-anchor-id="evaluating-metrics">Evaluating metrics</h3>
<p>Ideally, we would be in the neighborhood of the values estimated from our cross-validation. Let’s compile the predictions with the original values and do the necessary transformations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>sac_test_r <span class="ot">&lt;-</span>                                   </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    sac_test <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(                                                     <span class="co"># Transform data back into natural scale</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">.pred =</span> sac_pred[,<span class="dv">1</span>],                                   <span class="co"># Predicted value (log)</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">.pred_n =</span> <span class="fu">exp</span>(.pred),                                   <span class="co"># Predicted value (natural)</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">sqft =</span> <span class="fu">exp</span>(sqft_log),                                   <span class="co"># Sqft (natural)</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">price =</span> <span class="fu">exp</span>(price_log),                                 <span class="co"># Sales price (natural)</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">diff =</span> .pred_n <span class="sc">-</span> price                                  <span class="co"># Difference in price (natural)</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((sac_test_r<span class="sc">$</span>.pred <span class="sc">-</span> sac_test_r<span class="sc">$</span>price_log)<span class="sc">^</span><span class="dv">2</span>)               <span class="co"># Calculate mean squared error on log scale</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.123031</code></pre>
</div>
</div>
<p>We are, in fact, achieving about the same MSE with the testing data (<strong><sub>0.12<strong>) as we did with the training (</strong></sub>0.11</strong>).</p>
</section>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<section id="high-value-properties-1" class="level3">
<h3 class="anchored" data-anchor-id="high-value-properties-1">High value properties</h3>
<p>The whole goal of this modeling exercise was to find high value properties, where our predicted price exceeds the sales price.</p>
<p>Let’s generate a table of the top 10 properties in modeled value:</p>
<div id="property-list">
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>sac_test_r <span class="sc">%&gt;%</span>                                                          <span class="co"># Using the test data</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(diff)) <span class="sc">%&gt;%</span>                                             <span class="co"># Sort by the difference</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(city<span class="sc">:</span>type, sqft, price, .pred_n, diff) <span class="sc">%&gt;%</span>                   <span class="co"># Select relevant columns</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span>                                                        <span class="co"># Top-10 property values</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span>                                                            <span class="co"># Create a "great tables" object</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(                                                         <span class="co"># Add column labes</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">city =</span> <span class="st">"City"</span>, </span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">zip =</span> <span class="st">"Zip Code"</span>, </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">beds =</span> <span class="st">"Bedroom No"</span>, </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">baths =</span> <span class="st">"Bathroom No"</span>, </span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">"Property Type"</span>, </span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">sqft =</span> <span class="st">"Square Feet"</span>, </span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">price =</span> <span class="st">"Sales Price"</span>, </span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">.pred_n =</span> <span class="st">"Predicted Price"</span>, </span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">diff =</span> <span class="st">"Modeled Value"</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_number</span>(                                                         <span class="co"># Format sqft for decimals</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">columns =</span> <span class="fu">c</span>(sqft), </span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">decimals =</span> <span class="dv">0</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_currency</span>(                                                       <span class="co"># Format pricing data for currency</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">columns =</span> <span class="fu">c</span>(price, .pred_n, diff), </span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">decimals =</span> <span class="dv">0</span>, </span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">suffixing =</span> <span class="cn">TRUE</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_options</span>(                                                        <span class="co"># Format the column headers</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">column_labels.background.color =</span> <span class="st">"#BE0000"</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="pggkorypad" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#pggkorypad table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#pggkorypad thead, #pggkorypad tbody, #pggkorypad tfoot, #pggkorypad tr, #pggkorypad td, #pggkorypad th {
  border-style: none;
}

#pggkorypad p {
  margin: 0;
  padding: 0;
}

#pggkorypad .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#pggkorypad .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#pggkorypad .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#pggkorypad .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#pggkorypad .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pggkorypad .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pggkorypad .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pggkorypad .gt_col_heading {
  color: #FFFFFF;
  background-color: #BE0000;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#pggkorypad .gt_column_spanner_outer {
  color: #FFFFFF;
  background-color: #BE0000;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#pggkorypad .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#pggkorypad .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#pggkorypad .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#pggkorypad .gt_spanner_row {
  border-bottom-style: hidden;
}

#pggkorypad .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#pggkorypad .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#pggkorypad .gt_from_md > :first-child {
  margin-top: 0;
}

#pggkorypad .gt_from_md > :last-child {
  margin-bottom: 0;
}

#pggkorypad .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#pggkorypad .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#pggkorypad .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#pggkorypad .gt_row_group_first td {
  border-top-width: 2px;
}

#pggkorypad .gt_row_group_first th {
  border-top-width: 2px;
}

#pggkorypad .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pggkorypad .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#pggkorypad .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#pggkorypad .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pggkorypad .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pggkorypad .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#pggkorypad .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#pggkorypad .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#pggkorypad .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pggkorypad .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pggkorypad .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pggkorypad .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pggkorypad .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pggkorypad .gt_left {
  text-align: left;
}

#pggkorypad .gt_center {
  text-align: center;
}

#pggkorypad .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pggkorypad .gt_font_normal {
  font-weight: normal;
}

#pggkorypad .gt_font_bold {
  font-weight: bold;
}

#pggkorypad .gt_font_italic {
  font-style: italic;
}

#pggkorypad .gt_super {
  font-size: 65%;
}

#pggkorypad .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#pggkorypad .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#pggkorypad .gt_indent_1 {
  text-indent: 5px;
}

#pggkorypad .gt_indent_2 {
  text-indent: 10px;
}

#pggkorypad .gt_indent_3 {
  text-indent: 15px;
}

#pggkorypad .gt_indent_4 {
  text-indent: 20px;
}

#pggkorypad .gt_indent_5 {
  text-indent: 25px;
}

#pggkorypad .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#pggkorypad div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="City" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">City</th>
<th id="Zip Code" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Zip Code</th>
<th id="Bedroom No" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Bedroom No</th>
<th id="Bathroom No" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Bathroom No</th>
<th id="Property Type" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Property Type</th>
<th id="Square Feet" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Square Feet</th>
<th id="Sales Price" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Sales Price</th>
<th id="Predicted Price" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Predicted Price</th>
<th id="Modeled Value" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Modeled Value</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="city">SACRAMENTO</td>
<td class="gt_row gt_center" headers="zip">z95828</td>
<td class="gt_row gt_right" headers="beds">4</td>
<td class="gt_row gt_right" headers="baths">2.0</td>
<td class="gt_row gt_center" headers="type">Residential</td>
<td class="gt_row gt_right" headers="sqft">1,512</td>
<td class="gt_row gt_right" headers="price">$57K</td>
<td class="gt_row gt_right" headers=".pred_n">$208K</td>
<td class="gt_row gt_right" headers="diff">$151K</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="city">SACRAMENTO</td>
<td class="gt_row gt_center" headers="zip">z95828</td>
<td class="gt_row gt_right" headers="beds">4</td>
<td class="gt_row gt_right" headers="baths">4.0</td>
<td class="gt_row gt_center" headers="type">Multi_Family</td>
<td class="gt_row gt_right" headers="sqft">1,995</td>
<td class="gt_row gt_right" headers="price">$120K</td>
<td class="gt_row gt_right" headers=".pred_n">$263K</td>
<td class="gt_row gt_right" headers="diff">$143K</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="city">PLACERVILLE</td>
<td class="gt_row gt_center" headers="zip">z95667</td>
<td class="gt_row gt_right" headers="beds">2</td>
<td class="gt_row gt_right" headers="baths">2.0</td>
<td class="gt_row gt_center" headers="type">Residential</td>
<td class="gt_row gt_right" headers="sqft">2,750</td>
<td class="gt_row gt_right" headers="price">$270K</td>
<td class="gt_row gt_right" headers=".pred_n">$409K</td>
<td class="gt_row gt_right" headers="diff">$139K</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="city">RIO_LINDA</td>
<td class="gt_row gt_center" headers="zip">z95673</td>
<td class="gt_row gt_right" headers="beds">1</td>
<td class="gt_row gt_right" headers="baths">2.0</td>
<td class="gt_row gt_center" headers="type">Residential</td>
<td class="gt_row gt_right" headers="sqft">1,000</td>
<td class="gt_row gt_right" headers="price">$30K</td>
<td class="gt_row gt_right" headers=".pred_n">$145K</td>
<td class="gt_row gt_right" headers="diff">$115K</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="city">SACRAMENTO</td>
<td class="gt_row gt_center" headers="zip">z95828</td>
<td class="gt_row gt_right" headers="beds">3</td>
<td class="gt_row gt_right" headers="baths">2.0</td>
<td class="gt_row gt_center" headers="type">Residential</td>
<td class="gt_row gt_right" headers="sqft">2,161</td>
<td class="gt_row gt_right" headers="price">$170K</td>
<td class="gt_row gt_right" headers=".pred_n">$284K</td>
<td class="gt_row gt_right" headers="diff">$114K</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="city">SACRAMENTO</td>
<td class="gt_row gt_center" headers="zip">z95838</td>
<td class="gt_row gt_right" headers="beds">4</td>
<td class="gt_row gt_right" headers="baths">3.0</td>
<td class="gt_row gt_center" headers="type">Residential</td>
<td class="gt_row gt_right" headers="sqft">1,890</td>
<td class="gt_row gt_right" headers="price">$138K</td>
<td class="gt_row gt_right" headers=".pred_n">$248K</td>
<td class="gt_row gt_right" headers="diff">$110K</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="city">ELK_GROVE</td>
<td class="gt_row gt_center" headers="zip">z95758</td>
<td class="gt_row gt_right" headers="beds">5</td>
<td class="gt_row gt_right" headers="baths">3.0</td>
<td class="gt_row gt_center" headers="type">Residential</td>
<td class="gt_row gt_right" headers="sqft">3,468</td>
<td class="gt_row gt_right" headers="price">$320K</td>
<td class="gt_row gt_right" headers=".pred_n">$425K</td>
<td class="gt_row gt_right" headers="diff">$105K</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="city">ANTELOPE</td>
<td class="gt_row gt_center" headers="zip">z95843</td>
<td class="gt_row gt_right" headers="beds">4</td>
<td class="gt_row gt_right" headers="baths">3.0</td>
<td class="gt_row gt_center" headers="type">Residential</td>
<td class="gt_row gt_right" headers="sqft">2,652</td>
<td class="gt_row gt_right" headers="price">$240K</td>
<td class="gt_row gt_right" headers=".pred_n">$336K</td>
<td class="gt_row gt_right" headers="diff">$97K</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="city">GALT</td>
<td class="gt_row gt_center" headers="zip">z95632</td>
<td class="gt_row gt_right" headers="beds">5</td>
<td class="gt_row gt_right" headers="baths">3.5</td>
<td class="gt_row gt_center" headers="type">Residential</td>
<td class="gt_row gt_right" headers="sqft">3,499</td>
<td class="gt_row gt_right" headers="price">$355K</td>
<td class="gt_row gt_right" headers=".pred_n">$450K</td>
<td class="gt_row gt_right" headers="diff">$95K</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="city">ELK_GROVE</td>
<td class="gt_row gt_center" headers="zip">z95758</td>
<td class="gt_row gt_right" headers="beds">5</td>
<td class="gt_row gt_right" headers="baths">3.0</td>
<td class="gt_row gt_center" headers="type">Residential</td>
<td class="gt_row gt_right" headers="sqft">2,790</td>
<td class="gt_row gt_right" headers="price">$258K</td>
<td class="gt_row gt_right" headers=".pred_n">$352K</td>
<td class="gt_row gt_right" headers="diff">$94K</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>In the case of the very first property, our model suggests the property has a median worth of $208K but was sold at $57K. 1,512 square foot property with 4 bedrooms and 2 baths; at first blush, that does seem like great value.</p>
</section>
<section id="plotting-high-value-properties" class="level3">
<h3 class="anchored" data-anchor-id="plotting-high-value-properties">Plotting high value properties</h3>
<p>A common next step would be to map the high value properties. We can do that with the <code>{leaflet}</code> package:</p>
<div id="property-map">
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>sac_map <span class="ot">&lt;-</span>                                                              </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">leaflet</span>(<span class="at">height =</span> <span class="dv">800</span>, <span class="at">width =</span> <span class="dv">800</span>) <span class="sc">%&gt;%</span>                              <span class="co"># Create a leaflet map object</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addTiles</span>() <span class="sc">%&gt;%</span>                                                      <span class="co"># Setup tile layer</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setView</span>(<span class="at">lng =</span> <span class="sc">-</span><span class="fl">121.478851</span>, <span class="at">lat =</span> <span class="fl">38.575764</span>, <span class="at">zoom =</span> <span class="dv">10</span>)              <span class="co"># Localize zoom to Sacramento, CA</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>sac_map <span class="ot">&lt;-</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    sac_map <span class="sc">%&gt;%</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addProviderTiles</span>(<span class="st">"CartoDB.Positron"</span>) <span class="sc">%&gt;%</span>                            <span class="co"># Use a grayscale map theme</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addCircleMarkers</span>(                                                   <span class="co"># Add a circle point for every property</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> sac_test_r <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(diff)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">30</span>),         <span class="co"># Top-30, high value properties</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">lng =</span> <span class="sc">~</span>longitude,                                               <span class="co"># Mapped values</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">lat =</span> <span class="sc">~</span>latitude,                                                <span class="co"># Mapped values</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">radius =</span> <span class="dv">6</span>, </span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"#BE0000"</span>, </span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">fillOpacity =</span> <span class="fl">0.5</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>sac_map</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-e478cccae6edff9c8de2" style="width:100%;height:650px;" class="leaflet html-widget "></div>
<script type="application/json" data-for="htmlwidget-e478cccae6edff9c8de2">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org/copyright/\">OpenStreetMap<\/a>,  <a href=\"https://opendatacommons.org/licenses/odbl/\">ODbL<\/a>"}]},{"method":"addProviderTiles","args":["CartoDB.Positron",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addCircleMarkers","args":[[38.488628,38.490704,38.813546,38.687172,38.479343,38.646541,38.439565,38.725079,38.287785,38.42568,38.623571,38.691104,38.544162,38.879192,38.474099,38.673678,38.88156,38.421713,38.528479,38.493504,38.699714,38.672642,38.473162,38.70968,38.493484,38.681659,38.470187,38.689999,38.700909,38.435436],[-121.387759,-121.410176,-120.809254,-121.463933,-121.372553,-121.441139,-121.436606,-121.387698,-121.289903,-121.438062,-121.454884,-121.451832,-121.460652,-121.309477,-121.490711,-121.357471,-121.301343,-121.345191,-121.411806,-121.475304,-121.311635,-121.380343,-121.491085,-121.382328,-121.42035,-121.351705,-121.448149,-121.46322,-121.442979,-121.394536],6,null,null,{"interactive":true,"className":"","stroke":true,"color":"#BE0000","weight":5,"opacity":0.5,"fill":true,"fillColor":"#BE0000","fillOpacity":0.5},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"setView":[[38.575764,-121.478851],10,[]],"limits":{"lat":[38.287785,38.88156],"lng":[-121.491085,-120.809254]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="model.r_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>